<div class="container">
  <div class="row">
    <div class="col-md-12 mt-5">
      <p class="text-center bg-light"><span class="h4"><%= @race.name %></span>(<%= @reviews.count %>件のレビュー)</p>
    </div>
  </div>
  <!--レビューのまとめ始め-->
  <div class="row">
    <div class="col-md-6 ">
      <p class="text-left">開催地：<%= @race.venue %></p>
      <p class="text-left">出場費：<%= @race.cost %> 円</p>
      <p class="text-left">開催種目：<%= @race.categorie %></p>
      <p class="text-left">詳しくは下記を参照してください</p>
      <p class="text-left">公式サイト：<%= link_to @race.name,@race.link %></p>
    </div>
    <div class="col-md-6">
      <%= render 'avarage', race: @race,ave_score: @ave_score, ave_level: @ave_level,
      ave_course: @ave_course, ave_water: @ave_water, ave_sightseeing: @ave_sightseeing %>
    </div>
  </div>
  <!--レビューのまとめ終わり-->
  <div class ="row">
    <% @reviews.each do |review| %>
      <div class="col-md-3 border mt-3">
        <%= image_tag review.end_user.get_end_user_image(180,180), class: "mx-auto d-block mt-3"%>
        <p class="text-center"><%= review.end_user.name %>さん</p>
        <p class="text-center">投稿日:<%= review.created_at.strftime('%Y/%m/%d')%></p>
      </div>
      <div class="col-md-9 border mt-3 ">
        <p class="text-center h4 mt-2 mr-5">
          <%= review.title %>
          <!--お気に入り-->
          <% if current_end_user.review_favorited?(review.id) %>
            <%= link_to review_review_favorite_path(review.id, 1), method: :delete ,class: "btn btn-sm btn-outline-secondary ml-2" do %>
              <span>❤ <span><%= review.review_favorites.count %>
            <% end %>
          <% else %>
            <%= link_to review_review_favorites_path(review.id), method: :post,class: "btn btn-sm btn-outline-secondary ml-2" do %>
              <span>♡ <span><%= review.review_favorites.count %>
            <% end %>
          <% end %>
          <!--お気に入り 終わり-->
        </p>
        <div class ="row">
          <div class="col-md-7">
           <%= render "personal_star",review: review %>
          </div>
          <div class="col-md-5">
           <%= image_tag review.get_review_image(240,240), class: "mx-auto d-block"%>
          </div>
        </div>
        <div class ="row">
          <div class="col-md-12">
            <p class="text-left mx-3"><%= review.comment %></p>
          </div>
        </div>
        <hr>
        <div> <!--コメント一覧-->
        <% if review.review_comments.count == 0 %>
          <p>No Comment</p>
        <% else %>
          <% review.review_comments.each do |review_comment| %>
            <p><%= review_comment.end_user.name %></p>
            <p class="text-left mx-3"><%= review_comment.text %></p>
          <% end %>
        <% end %>
        </div> <!--コメント一覧終わり-->
        <div class ="row"> <!--コメント入力-->
          <div class="col-md-10 mb-4">
            <%= form_with model: ReviewComment,url:review_review_comments_path(review),local: true do|f| %>
              <%= f.text_field :text, autocomplete: "text", class: "form-control",placeholder: 'コメント' %>
              <%= f.hidden_field :end_user_id, value: current_end_user.id %>
              <%= f.hidden_field :review_id, value:review.id %>
          </div>
          <div class="col-md-2 mb-4">
              <%= f.submit '投稿する', class: "btn btn-sm btn-info" %>
            <% end %>
          </div>
        </div><!--コメント終わり-->
      </div>
    <% end %>
  </div>
  <div class="text-center m-5"><%=link_to "一覧に戻る",reviews_path,class: "btn btn-primary"%></div>
</div>